
(function () {
    'use strict';

    angular
        .module('app.tables', [])
        .controller('DataTableController', DataTableController);

    DataTableController.$inject = ['$resource', 'DTOptionsBuilder', 'DTColumnDefBuilder'];
    function DataTableController($resource, DTOptionsBuilder, DTColumnDefBuilder) {
        var vm = this;

        activate();

        ////////////////

        function activate() {

            // Ajax

            $resource('server/datatable.json').query().$promise.then(function (persons) {
                vm.persons = persons;
            });

            // Changing data

            vm.heroes = [{
                'id': 860,
                'firstName': 'Superman',
                'lastName': 'Yoda'
            }, {
                'id': 870,
                'firstName': 'Ace',
                'lastName': 'Ventura'
            }, {
                'id': 590,
                'firstName': 'Flash',
                'lastName': 'Gordon'
            }, {
                'id': 803,
                'firstName': 'Luke',
                'lastName': 'Skywalker'
            }
            ];

            vm.dtOptions = DTOptionsBuilder.newOptions()
              .withPaginationType('full_numbers')
              .withDOM('<"html5buttons"B>lTfgitp')
              .withButtons([
                  { extend: 'copy', className: 'btn-sm' },
                  { extend: 'csv', className: 'btn-sm' },
                  { extend: 'excel', className: 'btn-sm', title: 'XLS-File' },
                  { extend: 'pdf', className: 'btn-sm', title: $('title').text() },
                  { extend: 'print', className: 'btn-sm' }
              ]);

            vm.dtColumnDefs = [
                DTColumnDefBuilder.newColumnDef(0),
                DTColumnDefBuilder.newColumnDef(1),
                DTColumnDefBuilder.newColumnDef(2),
                DTColumnDefBuilder.newColumnDef(3).notSortable()
            ];
            vm.person2Add = _buildPerson2Add(1);
            vm.addPerson = addPerson;
            vm.modifyPerson = modifyPerson;
            vm.removePerson = removePerson;

            function _buildPerson2Add(id) {
                return {
                    id: id,
                    firstName: 'Foo' + id,
                    lastName: 'Bar' + id
                };
            }
            function addPerson() {
                vm.heroes.push(angular.copy(vm.person2Add));
                vm.person2Add = _buildPerson2Add(vm.person2Add.id + 1);
            }
            function modifyPerson(index) {
                vm.heroes.splice(index, 1, angular.copy(vm.person2Add));
                vm.person2Add = _buildPerson2Add(vm.person2Add.id + 1);
            }
            function removePerson(index) {
                vm.heroes.splice(index, 1);
            }

        }
    }
})();
